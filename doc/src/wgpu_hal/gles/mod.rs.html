<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Source of the Rust file `wgpu-hal/src/gles/mod.rs`."><meta name="keywords" content="rust, rustlang, rust-lang"><title>mod.rs - source</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../../normalize.css"><link rel="stylesheet" type="text/css" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../../storage.js"></script><script src="../../../crates.js"></script><script defer src="../../../main.js"></script><script defer src="../../../source-script.js"></script><script defer src="../../../source-files.js"></script>
    <noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../../favicon.svg"></head><body class="rustdoc source"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../../wgpu_hal/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../../../wgpu_hal/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div>
        </a></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../../wgpu_hal/index.html"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></a><nav class="sub"><div class="theme-picker hidden"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="22" height="22" alt="Pick another theme!" src="../../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><div class="example-wrap"><pre class="line-numbers"><span id="1">  1</span>
<span id="2">  2</span>
<span id="3">  3</span>
<span id="4">  4</span>
<span id="5">  5</span>
<span id="6">  6</span>
<span id="7">  7</span>
<span id="8">  8</span>
<span id="9">  9</span>
<span id="10"> 10</span>
<span id="11"> 11</span>
<span id="12"> 12</span>
<span id="13"> 13</span>
<span id="14"> 14</span>
<span id="15"> 15</span>
<span id="16"> 16</span>
<span id="17"> 17</span>
<span id="18"> 18</span>
<span id="19"> 19</span>
<span id="20"> 20</span>
<span id="21"> 21</span>
<span id="22"> 22</span>
<span id="23"> 23</span>
<span id="24"> 24</span>
<span id="25"> 25</span>
<span id="26"> 26</span>
<span id="27"> 27</span>
<span id="28"> 28</span>
<span id="29"> 29</span>
<span id="30"> 30</span>
<span id="31"> 31</span>
<span id="32"> 32</span>
<span id="33"> 33</span>
<span id="34"> 34</span>
<span id="35"> 35</span>
<span id="36"> 36</span>
<span id="37"> 37</span>
<span id="38"> 38</span>
<span id="39"> 39</span>
<span id="40"> 40</span>
<span id="41"> 41</span>
<span id="42"> 42</span>
<span id="43"> 43</span>
<span id="44"> 44</span>
<span id="45"> 45</span>
<span id="46"> 46</span>
<span id="47"> 47</span>
<span id="48"> 48</span>
<span id="49"> 49</span>
<span id="50"> 50</span>
<span id="51"> 51</span>
<span id="52"> 52</span>
<span id="53"> 53</span>
<span id="54"> 54</span>
<span id="55"> 55</span>
<span id="56"> 56</span>
<span id="57"> 57</span>
<span id="58"> 58</span>
<span id="59"> 59</span>
<span id="60"> 60</span>
<span id="61"> 61</span>
<span id="62"> 62</span>
<span id="63"> 63</span>
<span id="64"> 64</span>
<span id="65"> 65</span>
<span id="66"> 66</span>
<span id="67"> 67</span>
<span id="68"> 68</span>
<span id="69"> 69</span>
<span id="70"> 70</span>
<span id="71"> 71</span>
<span id="72"> 72</span>
<span id="73"> 73</span>
<span id="74"> 74</span>
<span id="75"> 75</span>
<span id="76"> 76</span>
<span id="77"> 77</span>
<span id="78"> 78</span>
<span id="79"> 79</span>
<span id="80"> 80</span>
<span id="81"> 81</span>
<span id="82"> 82</span>
<span id="83"> 83</span>
<span id="84"> 84</span>
<span id="85"> 85</span>
<span id="86"> 86</span>
<span id="87"> 87</span>
<span id="88"> 88</span>
<span id="89"> 89</span>
<span id="90"> 90</span>
<span id="91"> 91</span>
<span id="92"> 92</span>
<span id="93"> 93</span>
<span id="94"> 94</span>
<span id="95"> 95</span>
<span id="96"> 96</span>
<span id="97"> 97</span>
<span id="98"> 98</span>
<span id="99"> 99</span>
<span id="100">100</span>
<span id="101">101</span>
<span id="102">102</span>
<span id="103">103</span>
<span id="104">104</span>
<span id="105">105</span>
<span id="106">106</span>
<span id="107">107</span>
<span id="108">108</span>
<span id="109">109</span>
<span id="110">110</span>
<span id="111">111</span>
<span id="112">112</span>
<span id="113">113</span>
<span id="114">114</span>
<span id="115">115</span>
<span id="116">116</span>
<span id="117">117</span>
<span id="118">118</span>
<span id="119">119</span>
<span id="120">120</span>
<span id="121">121</span>
<span id="122">122</span>
<span id="123">123</span>
<span id="124">124</span>
<span id="125">125</span>
<span id="126">126</span>
<span id="127">127</span>
<span id="128">128</span>
<span id="129">129</span>
<span id="130">130</span>
<span id="131">131</span>
<span id="132">132</span>
<span id="133">133</span>
<span id="134">134</span>
<span id="135">135</span>
<span id="136">136</span>
<span id="137">137</span>
<span id="138">138</span>
<span id="139">139</span>
<span id="140">140</span>
<span id="141">141</span>
<span id="142">142</span>
<span id="143">143</span>
<span id="144">144</span>
<span id="145">145</span>
<span id="146">146</span>
<span id="147">147</span>
<span id="148">148</span>
<span id="149">149</span>
<span id="150">150</span>
<span id="151">151</span>
<span id="152">152</span>
<span id="153">153</span>
<span id="154">154</span>
<span id="155">155</span>
<span id="156">156</span>
<span id="157">157</span>
<span id="158">158</span>
<span id="159">159</span>
<span id="160">160</span>
<span id="161">161</span>
<span id="162">162</span>
<span id="163">163</span>
<span id="164">164</span>
<span id="165">165</span>
<span id="166">166</span>
<span id="167">167</span>
<span id="168">168</span>
<span id="169">169</span>
<span id="170">170</span>
<span id="171">171</span>
<span id="172">172</span>
<span id="173">173</span>
<span id="174">174</span>
<span id="175">175</span>
<span id="176">176</span>
<span id="177">177</span>
<span id="178">178</span>
<span id="179">179</span>
<span id="180">180</span>
<span id="181">181</span>
<span id="182">182</span>
<span id="183">183</span>
<span id="184">184</span>
<span id="185">185</span>
<span id="186">186</span>
<span id="187">187</span>
<span id="188">188</span>
<span id="189">189</span>
<span id="190">190</span>
<span id="191">191</span>
<span id="192">192</span>
<span id="193">193</span>
<span id="194">194</span>
<span id="195">195</span>
<span id="196">196</span>
<span id="197">197</span>
<span id="198">198</span>
<span id="199">199</span>
<span id="200">200</span>
<span id="201">201</span>
<span id="202">202</span>
<span id="203">203</span>
<span id="204">204</span>
<span id="205">205</span>
<span id="206">206</span>
<span id="207">207</span>
<span id="208">208</span>
<span id="209">209</span>
<span id="210">210</span>
<span id="211">211</span>
<span id="212">212</span>
<span id="213">213</span>
<span id="214">214</span>
<span id="215">215</span>
<span id="216">216</span>
<span id="217">217</span>
<span id="218">218</span>
<span id="219">219</span>
<span id="220">220</span>
<span id="221">221</span>
<span id="222">222</span>
<span id="223">223</span>
<span id="224">224</span>
<span id="225">225</span>
<span id="226">226</span>
<span id="227">227</span>
<span id="228">228</span>
<span id="229">229</span>
<span id="230">230</span>
<span id="231">231</span>
<span id="232">232</span>
<span id="233">233</span>
<span id="234">234</span>
<span id="235">235</span>
<span id="236">236</span>
<span id="237">237</span>
<span id="238">238</span>
<span id="239">239</span>
<span id="240">240</span>
<span id="241">241</span>
<span id="242">242</span>
<span id="243">243</span>
<span id="244">244</span>
<span id="245">245</span>
<span id="246">246</span>
<span id="247">247</span>
<span id="248">248</span>
<span id="249">249</span>
<span id="250">250</span>
<span id="251">251</span>
<span id="252">252</span>
<span id="253">253</span>
<span id="254">254</span>
<span id="255">255</span>
<span id="256">256</span>
<span id="257">257</span>
<span id="258">258</span>
<span id="259">259</span>
<span id="260">260</span>
<span id="261">261</span>
<span id="262">262</span>
<span id="263">263</span>
<span id="264">264</span>
<span id="265">265</span>
<span id="266">266</span>
<span id="267">267</span>
<span id="268">268</span>
<span id="269">269</span>
<span id="270">270</span>
<span id="271">271</span>
<span id="272">272</span>
<span id="273">273</span>
<span id="274">274</span>
<span id="275">275</span>
<span id="276">276</span>
<span id="277">277</span>
<span id="278">278</span>
<span id="279">279</span>
<span id="280">280</span>
<span id="281">281</span>
<span id="282">282</span>
<span id="283">283</span>
<span id="284">284</span>
<span id="285">285</span>
<span id="286">286</span>
<span id="287">287</span>
<span id="288">288</span>
<span id="289">289</span>
<span id="290">290</span>
<span id="291">291</span>
<span id="292">292</span>
<span id="293">293</span>
<span id="294">294</span>
<span id="295">295</span>
<span id="296">296</span>
<span id="297">297</span>
<span id="298">298</span>
<span id="299">299</span>
<span id="300">300</span>
<span id="301">301</span>
<span id="302">302</span>
<span id="303">303</span>
<span id="304">304</span>
<span id="305">305</span>
<span id="306">306</span>
<span id="307">307</span>
<span id="308">308</span>
<span id="309">309</span>
<span id="310">310</span>
<span id="311">311</span>
<span id="312">312</span>
<span id="313">313</span>
<span id="314">314</span>
<span id="315">315</span>
<span id="316">316</span>
<span id="317">317</span>
<span id="318">318</span>
<span id="319">319</span>
<span id="320">320</span>
<span id="321">321</span>
<span id="322">322</span>
<span id="323">323</span>
<span id="324">324</span>
<span id="325">325</span>
<span id="326">326</span>
<span id="327">327</span>
<span id="328">328</span>
<span id="329">329</span>
<span id="330">330</span>
<span id="331">331</span>
<span id="332">332</span>
<span id="333">333</span>
<span id="334">334</span>
<span id="335">335</span>
<span id="336">336</span>
<span id="337">337</span>
<span id="338">338</span>
<span id="339">339</span>
<span id="340">340</span>
<span id="341">341</span>
<span id="342">342</span>
<span id="343">343</span>
<span id="344">344</span>
<span id="345">345</span>
<span id="346">346</span>
<span id="347">347</span>
<span id="348">348</span>
<span id="349">349</span>
<span id="350">350</span>
<span id="351">351</span>
<span id="352">352</span>
<span id="353">353</span>
<span id="354">354</span>
<span id="355">355</span>
<span id="356">356</span>
<span id="357">357</span>
<span id="358">358</span>
<span id="359">359</span>
<span id="360">360</span>
<span id="361">361</span>
<span id="362">362</span>
<span id="363">363</span>
<span id="364">364</span>
<span id="365">365</span>
<span id="366">366</span>
<span id="367">367</span>
<span id="368">368</span>
<span id="369">369</span>
<span id="370">370</span>
<span id="371">371</span>
<span id="372">372</span>
<span id="373">373</span>
<span id="374">374</span>
<span id="375">375</span>
<span id="376">376</span>
<span id="377">377</span>
<span id="378">378</span>
<span id="379">379</span>
<span id="380">380</span>
<span id="381">381</span>
<span id="382">382</span>
<span id="383">383</span>
<span id="384">384</span>
<span id="385">385</span>
<span id="386">386</span>
<span id="387">387</span>
<span id="388">388</span>
<span id="389">389</span>
<span id="390">390</span>
<span id="391">391</span>
<span id="392">392</span>
<span id="393">393</span>
<span id="394">394</span>
<span id="395">395</span>
<span id="396">396</span>
<span id="397">397</span>
<span id="398">398</span>
<span id="399">399</span>
<span id="400">400</span>
<span id="401">401</span>
<span id="402">402</span>
<span id="403">403</span>
<span id="404">404</span>
<span id="405">405</span>
<span id="406">406</span>
<span id="407">407</span>
<span id="408">408</span>
<span id="409">409</span>
<span id="410">410</span>
<span id="411">411</span>
<span id="412">412</span>
<span id="413">413</span>
<span id="414">414</span>
<span id="415">415</span>
<span id="416">416</span>
<span id="417">417</span>
<span id="418">418</span>
<span id="419">419</span>
<span id="420">420</span>
<span id="421">421</span>
<span id="422">422</span>
<span id="423">423</span>
<span id="424">424</span>
<span id="425">425</span>
<span id="426">426</span>
<span id="427">427</span>
<span id="428">428</span>
<span id="429">429</span>
<span id="430">430</span>
<span id="431">431</span>
<span id="432">432</span>
<span id="433">433</span>
<span id="434">434</span>
<span id="435">435</span>
<span id="436">436</span>
<span id="437">437</span>
<span id="438">438</span>
<span id="439">439</span>
<span id="440">440</span>
<span id="441">441</span>
<span id="442">442</span>
<span id="443">443</span>
<span id="444">444</span>
<span id="445">445</span>
<span id="446">446</span>
<span id="447">447</span>
<span id="448">448</span>
<span id="449">449</span>
<span id="450">450</span>
<span id="451">451</span>
<span id="452">452</span>
<span id="453">453</span>
<span id="454">454</span>
<span id="455">455</span>
<span id="456">456</span>
<span id="457">457</span>
<span id="458">458</span>
<span id="459">459</span>
<span id="460">460</span>
<span id="461">461</span>
<span id="462">462</span>
<span id="463">463</span>
<span id="464">464</span>
<span id="465">465</span>
<span id="466">466</span>
<span id="467">467</span>
<span id="468">468</span>
<span id="469">469</span>
<span id="470">470</span>
<span id="471">471</span>
<span id="472">472</span>
<span id="473">473</span>
<span id="474">474</span>
<span id="475">475</span>
<span id="476">476</span>
<span id="477">477</span>
<span id="478">478</span>
<span id="479">479</span>
<span id="480">480</span>
<span id="481">481</span>
<span id="482">482</span>
<span id="483">483</span>
<span id="484">484</span>
<span id="485">485</span>
<span id="486">486</span>
<span id="487">487</span>
<span id="488">488</span>
<span id="489">489</span>
<span id="490">490</span>
<span id="491">491</span>
<span id="492">492</span>
<span id="493">493</span>
<span id="494">494</span>
<span id="495">495</span>
<span id="496">496</span>
<span id="497">497</span>
<span id="498">498</span>
<span id="499">499</span>
<span id="500">500</span>
<span id="501">501</span>
<span id="502">502</span>
<span id="503">503</span>
<span id="504">504</span>
<span id="505">505</span>
<span id="506">506</span>
<span id="507">507</span>
<span id="508">508</span>
<span id="509">509</span>
<span id="510">510</span>
<span id="511">511</span>
<span id="512">512</span>
<span id="513">513</span>
<span id="514">514</span>
<span id="515">515</span>
<span id="516">516</span>
<span id="517">517</span>
<span id="518">518</span>
<span id="519">519</span>
<span id="520">520</span>
<span id="521">521</span>
<span id="522">522</span>
<span id="523">523</span>
<span id="524">524</span>
<span id="525">525</span>
<span id="526">526</span>
<span id="527">527</span>
<span id="528">528</span>
<span id="529">529</span>
<span id="530">530</span>
<span id="531">531</span>
<span id="532">532</span>
<span id="533">533</span>
<span id="534">534</span>
<span id="535">535</span>
<span id="536">536</span>
<span id="537">537</span>
<span id="538">538</span>
<span id="539">539</span>
<span id="540">540</span>
<span id="541">541</span>
<span id="542">542</span>
<span id="543">543</span>
<span id="544">544</span>
<span id="545">545</span>
<span id="546">546</span>
<span id="547">547</span>
<span id="548">548</span>
<span id="549">549</span>
<span id="550">550</span>
<span id="551">551</span>
<span id="552">552</span>
<span id="553">553</span>
<span id="554">554</span>
<span id="555">555</span>
<span id="556">556</span>
<span id="557">557</span>
<span id="558">558</span>
<span id="559">559</span>
<span id="560">560</span>
<span id="561">561</span>
<span id="562">562</span>
<span id="563">563</span>
<span id="564">564</span>
<span id="565">565</span>
<span id="566">566</span>
<span id="567">567</span>
<span id="568">568</span>
<span id="569">569</span>
<span id="570">570</span>
<span id="571">571</span>
<span id="572">572</span>
<span id="573">573</span>
<span id="574">574</span>
<span id="575">575</span>
<span id="576">576</span>
<span id="577">577</span>
<span id="578">578</span>
<span id="579">579</span>
<span id="580">580</span>
<span id="581">581</span>
<span id="582">582</span>
<span id="583">583</span>
<span id="584">584</span>
<span id="585">585</span>
<span id="586">586</span>
<span id="587">587</span>
<span id="588">588</span>
<span id="589">589</span>
<span id="590">590</span>
<span id="591">591</span>
<span id="592">592</span>
<span id="593">593</span>
<span id="594">594</span>
<span id="595">595</span>
<span id="596">596</span>
<span id="597">597</span>
<span id="598">598</span>
<span id="599">599</span>
<span id="600">600</span>
<span id="601">601</span>
<span id="602">602</span>
<span id="603">603</span>
<span id="604">604</span>
<span id="605">605</span>
<span id="606">606</span>
<span id="607">607</span>
<span id="608">608</span>
<span id="609">609</span>
<span id="610">610</span>
<span id="611">611</span>
<span id="612">612</span>
<span id="613">613</span>
<span id="614">614</span>
<span id="615">615</span>
<span id="616">616</span>
<span id="617">617</span>
<span id="618">618</span>
<span id="619">619</span>
<span id="620">620</span>
<span id="621">621</span>
<span id="622">622</span>
<span id="623">623</span>
<span id="624">624</span>
<span id="625">625</span>
<span id="626">626</span>
<span id="627">627</span>
<span id="628">628</span>
<span id="629">629</span>
<span id="630">630</span>
<span id="631">631</span>
<span id="632">632</span>
<span id="633">633</span>
<span id="634">634</span>
<span id="635">635</span>
<span id="636">636</span>
<span id="637">637</span>
<span id="638">638</span>
<span id="639">639</span>
<span id="640">640</span>
<span id="641">641</span>
<span id="642">642</span>
<span id="643">643</span>
<span id="644">644</span>
<span id="645">645</span>
<span id="646">646</span>
<span id="647">647</span>
<span id="648">648</span>
<span id="649">649</span>
<span id="650">650</span>
<span id="651">651</span>
<span id="652">652</span>
<span id="653">653</span>
<span id="654">654</span>
<span id="655">655</span>
<span id="656">656</span>
<span id="657">657</span>
<span id="658">658</span>
<span id="659">659</span>
<span id="660">660</span>
<span id="661">661</span>
<span id="662">662</span>
<span id="663">663</span>
<span id="664">664</span>
<span id="665">665</span>
<span id="666">666</span>
<span id="667">667</span>
<span id="668">668</span>
<span id="669">669</span>
<span id="670">670</span>
<span id="671">671</span>
<span id="672">672</span>
<span id="673">673</span>
<span id="674">674</span>
<span id="675">675</span>
<span id="676">676</span>
<span id="677">677</span>
<span id="678">678</span>
<span id="679">679</span>
<span id="680">680</span>
<span id="681">681</span>
<span id="682">682</span>
<span id="683">683</span>
<span id="684">684</span>
<span id="685">685</span>
<span id="686">686</span>
<span id="687">687</span>
<span id="688">688</span>
<span id="689">689</span>
<span id="690">690</span>
<span id="691">691</span>
<span id="692">692</span>
<span id="693">693</span>
<span id="694">694</span>
<span id="695">695</span>
<span id="696">696</span>
<span id="697">697</span>
<span id="698">698</span>
<span id="699">699</span>
<span id="700">700</span>
<span id="701">701</span>
<span id="702">702</span>
<span id="703">703</span>
<span id="704">704</span>
<span id="705">705</span>
<span id="706">706</span>
<span id="707">707</span>
<span id="708">708</span>
<span id="709">709</span>
<span id="710">710</span>
<span id="711">711</span>
<span id="712">712</span>
<span id="713">713</span>
<span id="714">714</span>
<span id="715">715</span>
<span id="716">716</span>
<span id="717">717</span>
<span id="718">718</span>
<span id="719">719</span>
<span id="720">720</span>
<span id="721">721</span>
<span id="722">722</span>
<span id="723">723</span>
<span id="724">724</span>
<span id="725">725</span>
<span id="726">726</span>
<span id="727">727</span>
<span id="728">728</span>
<span id="729">729</span>
<span id="730">730</span>
<span id="731">731</span>
<span id="732">732</span>
<span id="733">733</span>
<span id="734">734</span>
<span id="735">735</span>
<span id="736">736</span>
<span id="737">737</span>
<span id="738">738</span>
<span id="739">739</span>
<span id="740">740</span>
<span id="741">741</span>
<span id="742">742</span>
<span id="743">743</span>
<span id="744">744</span>
<span id="745">745</span>
<span id="746">746</span>
<span id="747">747</span>
<span id="748">748</span>
</pre><pre class="rust"><code><span class="doccomment">/*!
# OpenGL ES3 API (aka GLES3).

Designed to work on Linux and Android, with context provided by EGL.

## Texture views

GLES3 doesn&#39;t really have separate texture view objects. We have to remember the
original texture and the sub-range into it. Problem is, however, that there is
no way to expose a subset of array layers or mip levels of a sampled texture.

## Binding model

Binding model is very different from WebGPU, especially with regards to samplers.
GLES3 has sampler objects, but they aren&#39;t separately bindable to the shaders.
Each sampled texture is exposed to the shader as a combined texture-sampler binding.

When building the pipeline layout, we linearize binding entries based on the groups
(uniform/storage buffers, uniform/storage textures), and record the mapping into
`BindGroupLayoutInfo`.
When a pipeline gets created, and we track all the texture-sampler associations
from the static use in the shader.
We only support at most one sampler used with each texture so far. The linear index
of this sampler is stored per texture slot in `SamplerBindMap` array.

The texture-sampler pairs get potentially invalidated in 2 places:
  - when a new pipeline is set, we update the linear indices of associated samplers
  - when a new bind group is set, we update both the textures and the samplers

We expect that the changes to sampler states between any 2 pipelines of the same layout
will be minimal, if any.

## Vertex data

Generally, vertex buffers are marked as dirty and lazily bound on draw.

GLES3 doesn&#39;t support &quot;base instance&quot; semantics. However, it&#39;s easy to support,
since we are forced to do late binding anyway. We just adjust the offsets
into the vertex data.

### Old path

In GLES-3.0 and WebGL2, vertex buffer layout is provided
together with the actual buffer binding.
We invalidate the attributes on the vertex buffer change, and re-bind them.

### New path

In GLES-3.1 and higher, the vertex buffer layout can be declared separately
from the vertex data itself. This mostly matches WebGPU, however there is a catch:
`stride` needs to be specified with the data, not as a part of the layout.

To address this, we invalidate the vertex buffers based on:
  - whether or not `start_instance` is used
  - stride has changed

*/</span>

<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">any</span>(<span class="ident">not</span>(<span class="ident">target_arch</span> <span class="op">=</span> <span class="string">&quot;wasm32&quot;</span>), <span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;emscripten&quot;</span>))]</span>
<span class="kw">mod</span> <span class="ident">egl</span>;
<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">all</span>(<span class="ident">target_arch</span> <span class="op">=</span> <span class="string">&quot;wasm32&quot;</span>, <span class="ident">not</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;emscripten&quot;</span>)))]</span>
<span class="kw">mod</span> <span class="ident">web</span>;

<span class="kw">mod</span> <span class="ident">adapter</span>;
<span class="kw">mod</span> <span class="ident">command</span>;
<span class="kw">mod</span> <span class="ident">conv</span>;
<span class="kw">mod</span> <span class="ident">device</span>;
<span class="kw">mod</span> <span class="ident">queue</span>;

<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">any</span>(<span class="ident">not</span>(<span class="ident">target_arch</span> <span class="op">=</span> <span class="string">&quot;wasm32&quot;</span>), <span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;emscripten&quot;</span>))]</span>
<span class="kw">use</span> <span class="ident"><span class="self">self</span>::egl</span>::{<span class="ident">AdapterContext</span>, <span class="ident">Instance</span>, <span class="ident">Surface</span>};

<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">all</span>(<span class="ident">target_arch</span> <span class="op">=</span> <span class="string">&quot;wasm32&quot;</span>, <span class="ident">not</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;emscripten&quot;</span>)))]</span>
<span class="kw">use</span> <span class="ident"><span class="self">self</span>::web</span>::{<span class="ident">AdapterContext</span>, <span class="ident">Instance</span>, <span class="ident">Surface</span>};

<span class="kw">use</span> <span class="ident">arrayvec::ArrayVec</span>;

<span class="kw">use</span> <span class="ident">glow::HasContext</span>;

<span class="kw">use</span> <span class="ident">std</span>::{<span class="ident">ops::Range</span>, <span class="ident">sync::Arc</span>};

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>)]</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">Api</span>;

<span class="comment">//Note: we can support more samplers if not every one of them is used at a time,</span>
<span class="comment">// but it probably doesn&#39;t worth it.</span>
<span class="kw">const</span> <span class="ident">MAX_TEXTURE_SLOTS</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="number">16</span>;
<span class="kw">const</span> <span class="ident">MAX_SAMPLERS</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="number">16</span>;
<span class="kw">const</span> <span class="ident">MAX_VERTEX_ATTRIBUTES</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="number">16</span>;
<span class="kw">const</span> <span class="ident">ZERO_BUFFER_SIZE</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="number">256</span> <span class="op">&lt;</span><span class="op">&lt;</span> <span class="number">10</span>;
<span class="kw">const</span> <span class="ident">MAX_PUSH_CONSTANTS</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="number">16</span>;

<span class="kw">impl</span> <span class="ident"><span class="kw">crate</span>::Api</span> <span class="kw">for</span> <span class="ident">Api</span> {
    <span class="kw">type</span> <span class="ident">Instance</span> <span class="op">=</span> <span class="ident">Instance</span>;
    <span class="kw">type</span> <span class="ident">Surface</span> <span class="op">=</span> <span class="ident">Surface</span>;
    <span class="kw">type</span> <span class="ident">Adapter</span> <span class="op">=</span> <span class="ident">Adapter</span>;
    <span class="kw">type</span> <span class="ident">Device</span> <span class="op">=</span> <span class="ident">Device</span>;

    <span class="kw">type</span> <span class="ident">Queue</span> <span class="op">=</span> <span class="ident">Queue</span>;
    <span class="kw">type</span> <span class="ident">CommandEncoder</span> <span class="op">=</span> <span class="ident">CommandEncoder</span>;
    <span class="kw">type</span> <span class="ident">CommandBuffer</span> <span class="op">=</span> <span class="ident">CommandBuffer</span>;

    <span class="kw">type</span> <span class="ident">Buffer</span> <span class="op">=</span> <span class="ident">Buffer</span>;
    <span class="kw">type</span> <span class="ident">Texture</span> <span class="op">=</span> <span class="ident">Texture</span>;
    <span class="kw">type</span> <span class="ident">SurfaceTexture</span> <span class="op">=</span> <span class="ident">Texture</span>;
    <span class="kw">type</span> <span class="ident">TextureView</span> <span class="op">=</span> <span class="ident">TextureView</span>;
    <span class="kw">type</span> <span class="ident">Sampler</span> <span class="op">=</span> <span class="ident">Sampler</span>;
    <span class="kw">type</span> <span class="ident">QuerySet</span> <span class="op">=</span> <span class="ident">QuerySet</span>;
    <span class="kw">type</span> <span class="ident">Fence</span> <span class="op">=</span> <span class="ident">Fence</span>;

    <span class="kw">type</span> <span class="ident">BindGroupLayout</span> <span class="op">=</span> <span class="ident">BindGroupLayout</span>;
    <span class="kw">type</span> <span class="ident">BindGroup</span> <span class="op">=</span> <span class="ident">BindGroup</span>;
    <span class="kw">type</span> <span class="ident">PipelineLayout</span> <span class="op">=</span> <span class="ident">PipelineLayout</span>;
    <span class="kw">type</span> <span class="ident">ShaderModule</span> <span class="op">=</span> <span class="ident">ShaderModule</span>;
    <span class="kw">type</span> <span class="ident">RenderPipeline</span> <span class="op">=</span> <span class="ident">RenderPipeline</span>;
    <span class="kw">type</span> <span class="ident">ComputePipeline</span> <span class="op">=</span> <span class="ident">ComputePipeline</span>;
}

<span class="macro">bitflags::bitflags!</span> {
    <span class="doccomment">/// Flags that affect internal code paths but do not</span>
    <span class="doccomment">/// change the exposed feature set.</span>
    <span class="kw">struct</span> <span class="ident">PrivateCapabilities</span>: <span class="ident">u32</span> {
        <span class="doccomment">/// Indicates support for `glBufferStorage` allocation.</span>
        <span class="kw">const</span> <span class="ident">BUFFER_ALLOCATION</span> <span class="op">=</span> <span class="number">1</span> <span class="op">&lt;</span><span class="op">&lt;</span> <span class="number">0</span>;
        <span class="doccomment">/// Support explicit layouts in shader.</span>
        <span class="kw">const</span> <span class="ident">SHADER_BINDING_LAYOUT</span> <span class="op">=</span> <span class="number">1</span> <span class="op">&lt;</span><span class="op">&lt;</span> <span class="number">1</span>;
        <span class="doccomment">/// Support extended shadow sampling instructions.</span>
        <span class="kw">const</span> <span class="ident">SHADER_TEXTURE_SHADOW_LOD</span> <span class="op">=</span> <span class="number">1</span> <span class="op">&lt;</span><span class="op">&lt;</span> <span class="number">2</span>;
        <span class="doccomment">/// Support memory barriers.</span>
        <span class="kw">const</span> <span class="ident">MEMORY_BARRIERS</span> <span class="op">=</span> <span class="number">1</span> <span class="op">&lt;</span><span class="op">&lt;</span> <span class="number">3</span>;
        <span class="doccomment">/// Vertex buffer layouts separate from the data.</span>
        <span class="kw">const</span> <span class="ident">VERTEX_BUFFER_LAYOUT</span> <span class="op">=</span> <span class="number">1</span> <span class="op">&lt;</span><span class="op">&lt;</span> <span class="number">4</span>;
        <span class="doccomment">/// Indicates that buffers used as `GL_ELEMENT_ARRAY_BUFFER` may be created / initialized / used</span>
        <span class="doccomment">/// as other targets, if not present they must not be mixed with other targets.</span>
        <span class="kw">const</span> <span class="ident">INDEX_BUFFER_ROLE_CHANGE</span> <span class="op">=</span> <span class="number">1</span> <span class="op">&lt;</span><span class="op">&lt;</span> <span class="number">5</span>;
        <span class="doccomment">/// Indicates that the device supports disabling draw buffers</span>
        <span class="kw">const</span> <span class="ident">CAN_DISABLE_DRAW_BUFFER</span> <span class="op">=</span> <span class="number">1</span> <span class="op">&lt;</span><span class="op">&lt;</span> <span class="number">6</span>;
    }
}

<span class="macro">bitflags::bitflags!</span> {
    <span class="doccomment">/// Flags that indicate necessary workarounds for specific devices or driver bugs</span>
    <span class="kw">struct</span> <span class="ident">Workarounds</span>: <span class="ident">u32</span> {
        <span class="comment">// Needs workaround for Intel Mesa bug:</span>
        <span class="comment">// https://gitlab.freedesktop.org/mesa/mesa/-/issues/2565.</span>
        <span class="comment">//</span>
        <span class="comment">// This comment</span>
        <span class="comment">// (https://gitlab.freedesktop.org/mesa/mesa/-/merge_requests/4972/diffs?diff_id=75888#22f5d1004713c9bbf857988c7efb81631ab88f99_323_327)</span>
        <span class="comment">// seems to indicate all skylake models are effected.</span>
        <span class="kw">const</span> <span class="ident">MESA_I915_SRGB_SHADER_CLEAR</span> <span class="op">=</span> <span class="number">1</span> <span class="op">&lt;</span><span class="op">&lt;</span> <span class="number">0</span>;
        <span class="doccomment">/// Buffer map must emulated becuase it is not supported natively</span>
        <span class="kw">const</span> <span class="ident">EMULATE_BUFFER_MAP</span> <span class="op">=</span> <span class="number">1</span> <span class="op">&lt;</span><span class="op">&lt;</span> <span class="number">1</span>;
    }
}

<span class="kw">type</span> <span class="ident">BindTarget</span> <span class="op">=</span> <span class="ident">u32</span>;

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Debug</span>, <span class="ident">Clone</span>, <span class="ident">Copy</span>)]</span>
<span class="kw">enum</span> <span class="ident">VertexAttribKind</span> {
    <span class="ident">Float</span>, <span class="comment">// glVertexAttribPointer</span>
    <span class="ident">Integer</span>, <span class="comment">// glVertexAttribIPointer</span>
           <span class="comment">//Double,  // glVertexAttribLPointer</span>
}

<span class="kw">impl</span> <span class="ident">Default</span> <span class="kw">for</span> <span class="ident">VertexAttribKind</span> {
    <span class="kw">fn</span> <span class="ident">default</span>() -&gt; <span class="self">Self</span> {
        <span class="ident"><span class="self">Self</span>::Float</span>
    }
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Debug</span>)]</span>
<span class="kw">struct</span> <span class="ident">TextureFormatDesc</span> {
    <span class="ident">internal</span>: <span class="ident">u32</span>,
    <span class="ident">external</span>: <span class="ident">u32</span>,
    <span class="ident">data_type</span>: <span class="ident">u32</span>,
}

<span class="kw">struct</span> <span class="ident">AdapterShared</span> {
    <span class="ident">context</span>: <span class="ident">AdapterContext</span>,
    <span class="ident">private_caps</span>: <span class="ident">PrivateCapabilities</span>,
    <span class="ident">workarounds</span>: <span class="ident">Workarounds</span>,
    <span class="ident">shading_language_version</span>: <span class="ident">naga::back::glsl::Version</span>,
}

<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">Adapter</span> {
    <span class="ident">shared</span>: <span class="ident">Arc</span><span class="op">&lt;</span><span class="ident">AdapterShared</span><span class="op">&gt;</span>,
}

<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">Device</span> {
    <span class="ident">shared</span>: <span class="ident">Arc</span><span class="op">&lt;</span><span class="ident">AdapterShared</span><span class="op">&gt;</span>,
    <span class="ident">main_vao</span>: <span class="ident">glow::VertexArray</span>,
    <span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">feature</span> <span class="op">=</span> <span class="string">&quot;renderdoc&quot;</span>)]</span>
    <span class="ident">render_doc</span>: <span class="ident"><span class="kw">crate</span>::auxil::renderdoc::RenderDoc</span>,
}

<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">Queue</span> {
    <span class="ident">shared</span>: <span class="ident">Arc</span><span class="op">&lt;</span><span class="ident">AdapterShared</span><span class="op">&gt;</span>,
    <span class="ident">features</span>: <span class="ident">wgt::Features</span>,
    <span class="ident">draw_fbo</span>: <span class="ident">glow::Framebuffer</span>,
    <span class="ident">copy_fbo</span>: <span class="ident">glow::Framebuffer</span>,
    <span class="doccomment">/// Shader program used to clear the screen for [`PrivateCapabilities::REQUIRES_SHADER_CLEAR`]</span>
    <span class="doccomment">/// devices.</span>
    <span class="ident">shader_clear_program</span>: <span class="ident">glow::Program</span>,
    <span class="doccomment">/// The uniform location of the color uniform in the shader clear program</span>
    <span class="ident">shader_clear_program_color_uniform_location</span>: <span class="ident">glow::UniformLocation</span>,
    <span class="doccomment">/// Keep a reasonably large buffer filled with zeroes, so that we can implement `ClearBuffer` of</span>
    <span class="doccomment">/// zeroes by copying from it.</span>
    <span class="ident">zero_buffer</span>: <span class="ident">glow::Buffer</span>,
    <span class="ident">temp_query_results</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">u64</span><span class="op">&gt;</span>,
    <span class="ident">draw_buffer_count</span>: <span class="ident">u8</span>,
    <span class="ident">current_index_buffer</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">glow::Buffer</span><span class="op">&gt;</span>,
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Debug</span>)]</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">Buffer</span> {
    <span class="ident">raw</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">glow::Buffer</span><span class="op">&gt;</span>,
    <span class="ident">target</span>: <span class="ident">BindTarget</span>,
    <span class="ident">size</span>: <span class="ident">wgt::BufferAddress</span>,
    <span class="ident">map_flags</span>: <span class="ident">u32</span>,
    <span class="ident">data</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">Arc</span><span class="op">&lt;</span><span class="ident">std::sync::Mutex</span><span class="op">&lt;</span><span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">u8</span><span class="op">&gt;</span><span class="op">&gt;</span><span class="op">&gt;</span><span class="op">&gt;</span>,
}

<span class="comment">// Safe: WASM doesn&#39;t have threads</span>
<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">target_arch</span> <span class="op">=</span> <span class="string">&quot;wasm32&quot;</span>)]</span>
<span class="kw">unsafe</span> <span class="kw">impl</span> <span class="ident">Sync</span> <span class="kw">for</span> <span class="ident">Buffer</span> {}
<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">target_arch</span> <span class="op">=</span> <span class="string">&quot;wasm32&quot;</span>)]</span>
<span class="kw">unsafe</span> <span class="kw">impl</span> <span class="ident">Send</span> <span class="kw">for</span> <span class="ident">Buffer</span> {}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Debug</span>)]</span>
<span class="kw">enum</span> <span class="ident">TextureInner</span> {
    <span class="ident">Renderbuffer</span> {
        <span class="ident">raw</span>: <span class="ident">glow::Renderbuffer</span>,
    },
    <span class="ident">DefaultRenderbuffer</span>,
    <span class="ident">Texture</span> {
        <span class="ident">raw</span>: <span class="ident">glow::Texture</span>,
        <span class="ident">target</span>: <span class="ident">BindTarget</span>,
    },
}

<span class="kw">impl</span> <span class="ident">TextureInner</span> {
    <span class="kw">fn</span> <span class="ident">as_native</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; (<span class="ident">glow::Texture</span>, <span class="ident">BindTarget</span>) {
        <span class="kw">match</span> <span class="kw-2">*</span><span class="self">self</span> {
            <span class="ident"><span class="self">Self</span>::Renderbuffer</span> { .. } <span class="op">|</span> <span class="ident"><span class="self">Self</span>::DefaultRenderbuffer</span> =&gt; {
                <span class="macro">panic!</span>(<span class="string">&quot;Unexpected renderbuffer&quot;</span>);
            }
            <span class="ident"><span class="self">Self</span>::Texture</span> { <span class="ident">raw</span>, <span class="ident">target</span> } =&gt; (<span class="ident">raw</span>, <span class="ident">target</span>),
        }
    }
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Debug</span>)]</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">Texture</span> {
    <span class="ident">inner</span>: <span class="ident">TextureInner</span>,
    <span class="ident">mip_level_count</span>: <span class="ident">u32</span>,
    <span class="ident">array_layer_count</span>: <span class="ident">u32</span>,
    <span class="ident">format</span>: <span class="ident">wgt::TextureFormat</span>,
    <span class="attribute">#[<span class="ident">allow</span>(<span class="ident">unused</span>)]</span>
    <span class="ident">format_desc</span>: <span class="ident">TextureFormatDesc</span>,
    <span class="ident">copy_size</span>: <span class="ident"><span class="kw">crate</span>::CopyExtent</span>,
}

<span class="kw">impl</span> <span class="ident">Texture</span> {
    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">default_framebuffer</span>(<span class="ident">format</span>: <span class="ident">wgt::TextureFormat</span>) -&gt; <span class="self">Self</span> {
        <span class="self">Self</span> {
            <span class="ident">inner</span>: <span class="ident">TextureInner::DefaultRenderbuffer</span>,
            <span class="ident">mip_level_count</span>: <span class="number">1</span>,
            <span class="ident">array_layer_count</span>: <span class="number">1</span>,
            <span class="ident">format</span>,
            <span class="ident">format_desc</span>: <span class="ident">TextureFormatDesc</span> {
                <span class="ident">internal</span>: <span class="number">0</span>,
                <span class="ident">external</span>: <span class="number">0</span>,
                <span class="ident">data_type</span>: <span class="number">0</span>,
            },
            <span class="ident">copy_size</span>: <span class="ident"><span class="kw">crate</span>::CopyExtent</span> {
                <span class="ident">width</span>: <span class="number">0</span>,
                <span class="ident">height</span>: <span class="number">0</span>,
                <span class="ident">depth</span>: <span class="number">0</span>,
            },
        }
    }
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Debug</span>)]</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">TextureView</span> {
    <span class="ident">inner</span>: <span class="ident">TextureInner</span>,
    <span class="ident">sample_type</span>: <span class="ident">wgt::TextureSampleType</span>,
    <span class="ident">aspects</span>: <span class="ident"><span class="kw">crate</span>::FormatAspects</span>,
    <span class="ident">mip_levels</span>: <span class="ident">Range</span><span class="op">&lt;</span><span class="ident">u32</span><span class="op">&gt;</span>,
    <span class="ident">array_layers</span>: <span class="ident">Range</span><span class="op">&lt;</span><span class="ident">u32</span><span class="op">&gt;</span>,
    <span class="ident">format</span>: <span class="ident">wgt::TextureFormat</span>,
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Debug</span>)]</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">Sampler</span> {
    <span class="ident">raw</span>: <span class="ident">glow::Sampler</span>,
}

<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">BindGroupLayout</span> {
    <span class="ident">entries</span>: <span class="ident">Arc</span><span class="op">&lt;</span>[<span class="ident">wgt::BindGroupLayoutEntry</span>]<span class="op">&gt;</span>,
}

<span class="kw">struct</span> <span class="ident">BindGroupLayoutInfo</span> {
    <span class="ident">entries</span>: <span class="ident">Arc</span><span class="op">&lt;</span>[<span class="ident">wgt::BindGroupLayoutEntry</span>]<span class="op">&gt;</span>,
    <span class="doccomment">/// Mapping of resources, indexed by `binding`, into the whole layout space.</span>
    <span class="doccomment">/// For texture resources, the value is the texture slot index.</span>
    <span class="doccomment">/// For sampler resources, the value is the index of the sampler in the whole layout.</span>
    <span class="doccomment">/// For buffers, the value is the uniform or storage slot index.</span>
    <span class="doccomment">/// For unused bindings, the value is `!0`</span>
    <span class="ident">binding_to_slot</span>: <span class="ident">Box</span><span class="op">&lt;</span>[<span class="ident">u8</span>]<span class="op">&gt;</span>,
}

<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">PipelineLayout</span> {
    <span class="ident">group_infos</span>: <span class="ident">Box</span><span class="op">&lt;</span>[<span class="ident">BindGroupLayoutInfo</span>]<span class="op">&gt;</span>,
    <span class="ident">naga_options</span>: <span class="ident">naga::back::glsl::Options</span>,
}

<span class="kw">impl</span> <span class="ident">PipelineLayout</span> {
    <span class="kw">fn</span> <span class="ident">get_slot</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">br</span>: <span class="kw-2">&amp;</span><span class="ident">naga::ResourceBinding</span>) -&gt; <span class="ident">u8</span> {
        <span class="kw">let</span> <span class="ident">group_info</span> <span class="op">=</span> <span class="kw-2">&amp;</span><span class="self">self</span>.<span class="ident">group_infos</span>[<span class="ident">br</span>.<span class="ident">group</span> <span class="kw">as</span> <span class="ident">usize</span>];
        <span class="ident">group_info</span>.<span class="ident">binding_to_slot</span>[<span class="ident">br</span>.<span class="ident">binding</span> <span class="kw">as</span> <span class="ident">usize</span>]
    }
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Debug</span>)]</span>
<span class="kw">enum</span> <span class="ident">BindingRegister</span> {
    <span class="ident">UniformBuffers</span>,
    <span class="ident">StorageBuffers</span>,
    <span class="ident">Textures</span>,
    <span class="ident">Images</span>,
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Debug</span>)]</span>
<span class="kw">enum</span> <span class="ident">RawBinding</span> {
    <span class="ident">Buffer</span> {
        <span class="ident">raw</span>: <span class="ident">glow::Buffer</span>,
        <span class="ident">offset</span>: <span class="ident">i32</span>,
        <span class="ident">size</span>: <span class="ident">i32</span>,
    },
    <span class="ident">Texture</span> {
        <span class="ident">raw</span>: <span class="ident">glow::Texture</span>,
        <span class="ident">target</span>: <span class="ident">BindTarget</span>,
        <span class="comment">//TODO: mip levels, array layers</span>
    },
    <span class="ident">Image</span>(<span class="ident">ImageBinding</span>),
    <span class="ident">Sampler</span>(<span class="ident">glow::Sampler</span>),
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Debug</span>)]</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">BindGroup</span> {
    <span class="ident">contents</span>: <span class="ident">Box</span><span class="op">&lt;</span>[<span class="ident">RawBinding</span>]<span class="op">&gt;</span>,
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Debug</span>)]</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">ShaderModule</span> {
    <span class="ident">naga</span>: <span class="ident"><span class="kw">crate</span>::NagaShader</span>,
    <span class="ident">label</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">String</span><span class="op">&gt;</span>,
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Debug</span>, <span class="ident">Default</span>)]</span>
<span class="kw">struct</span> <span class="ident">VertexFormatDesc</span> {
    <span class="ident">element_count</span>: <span class="ident">i32</span>,
    <span class="ident">element_format</span>: <span class="ident">u32</span>,
    <span class="ident">attrib_kind</span>: <span class="ident">VertexAttribKind</span>,
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Debug</span>, <span class="ident">Default</span>)]</span>
<span class="kw">struct</span> <span class="ident">AttributeDesc</span> {
    <span class="ident">location</span>: <span class="ident">u32</span>,
    <span class="ident">offset</span>: <span class="ident">u32</span>,
    <span class="ident">buffer_index</span>: <span class="ident">u32</span>,
    <span class="ident">format_desc</span>: <span class="ident">VertexFormatDesc</span>,
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Debug</span>)]</span>
<span class="kw">struct</span> <span class="ident">BufferBinding</span> {
    <span class="ident">raw</span>: <span class="ident">glow::Buffer</span>,
    <span class="ident">offset</span>: <span class="ident">wgt::BufferAddress</span>,
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Debug</span>)]</span>
<span class="kw">struct</span> <span class="ident">ImageBinding</span> {
    <span class="ident">raw</span>: <span class="ident">glow::Texture</span>,
    <span class="ident">mip_level</span>: <span class="ident">u32</span>,
    <span class="ident">array_layer</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">u32</span><span class="op">&gt;</span>,
    <span class="ident">access</span>: <span class="ident">u32</span>,
    <span class="ident">format</span>: <span class="ident">u32</span>,
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Debug</span>, <span class="ident">Default</span>, <span class="ident">PartialEq</span>)]</span>
<span class="kw">struct</span> <span class="ident">VertexBufferDesc</span> {
    <span class="ident">step</span>: <span class="ident">wgt::VertexStepMode</span>,
    <span class="ident">stride</span>: <span class="ident">u32</span>,
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Debug</span>, <span class="ident">Default</span>)]</span>
<span class="kw">struct</span> <span class="ident">UniformDesc</span> {
    <span class="ident">location</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">glow::UniformLocation</span><span class="op">&gt;</span>,
    <span class="ident">size</span>: <span class="ident">u32</span>,
    <span class="ident">utype</span>: <span class="ident">u32</span>,
}

<span class="comment">// Safe: WASM doesn&#39;t have threads</span>
<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">target_arch</span> <span class="op">=</span> <span class="string">&quot;wasm32&quot;</span>)]</span>
<span class="kw">unsafe</span> <span class="kw">impl</span> <span class="ident">Sync</span> <span class="kw">for</span> <span class="ident">UniformDesc</span> {}
<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">target_arch</span> <span class="op">=</span> <span class="string">&quot;wasm32&quot;</span>)]</span>
<span class="kw">unsafe</span> <span class="kw">impl</span> <span class="ident">Send</span> <span class="kw">for</span> <span class="ident">UniformDesc</span> {}

<span class="doccomment">/// For each texture in the pipeline layout, store the index of the only</span>
<span class="doccomment">/// sampler (in this layout) that the texture is used with.</span>
<span class="kw">type</span> <span class="ident">SamplerBindMap</span> <span class="op">=</span> [<span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">u8</span><span class="op">&gt;</span>; <span class="ident">MAX_TEXTURE_SLOTS</span>];

<span class="kw">struct</span> <span class="ident">PipelineInner</span> {
    <span class="ident">program</span>: <span class="ident">glow::Program</span>,
    <span class="ident">sampler_map</span>: <span class="ident">SamplerBindMap</span>,
    <span class="ident">uniforms</span>: [<span class="ident">UniformDesc</span>; <span class="ident">MAX_PUSH_CONSTANTS</span>],
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Debug</span>)]</span>
<span class="kw">struct</span> <span class="ident">DepthState</span> {
    <span class="ident">function</span>: <span class="ident">u32</span>,
    <span class="ident">mask</span>: <span class="ident">bool</span>,
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Debug</span>, <span class="ident">PartialEq</span>)]</span>
<span class="kw">struct</span> <span class="ident">BlendComponent</span> {
    <span class="ident">src</span>: <span class="ident">u32</span>,
    <span class="ident">dst</span>: <span class="ident">u32</span>,
    <span class="ident">equation</span>: <span class="ident">u32</span>,
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Debug</span>, <span class="ident">PartialEq</span>)]</span>
<span class="kw">struct</span> <span class="ident">BlendDesc</span> {
    <span class="ident">alpha</span>: <span class="ident">BlendComponent</span>,
    <span class="ident">color</span>: <span class="ident">BlendComponent</span>,
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Debug</span>, <span class="ident">Default</span>, <span class="ident">PartialEq</span>)]</span>
<span class="kw">struct</span> <span class="ident">ColorTargetDesc</span> {
    <span class="ident">mask</span>: <span class="ident">wgt::ColorWrites</span>,
    <span class="ident">blend</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">BlendDesc</span><span class="op">&gt;</span>,
}

<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">RenderPipeline</span> {
    <span class="ident">inner</span>: <span class="ident">PipelineInner</span>,
    <span class="ident">primitive</span>: <span class="ident">wgt::PrimitiveState</span>,
    <span class="ident">vertex_buffers</span>: <span class="ident">Box</span><span class="op">&lt;</span>[<span class="ident">VertexBufferDesc</span>]<span class="op">&gt;</span>,
    <span class="ident">vertex_attributes</span>: <span class="ident">Box</span><span class="op">&lt;</span>[<span class="ident">AttributeDesc</span>]<span class="op">&gt;</span>,
    <span class="ident">color_targets</span>: <span class="ident">Box</span><span class="op">&lt;</span>[<span class="ident">ColorTargetDesc</span>]<span class="op">&gt;</span>,
    <span class="ident">depth</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">DepthState</span><span class="op">&gt;</span>,
    <span class="ident">depth_bias</span>: <span class="ident">wgt::DepthBiasState</span>,
    <span class="ident">stencil</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">StencilState</span><span class="op">&gt;</span>,
}

<span class="comment">// SAFE: WASM doesn&#39;t have threads</span>
<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">target_arch</span> <span class="op">=</span> <span class="string">&quot;wasm32&quot;</span>)]</span>
<span class="kw">unsafe</span> <span class="kw">impl</span> <span class="ident">Send</span> <span class="kw">for</span> <span class="ident">RenderPipeline</span> {}
<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">target_arch</span> <span class="op">=</span> <span class="string">&quot;wasm32&quot;</span>)]</span>
<span class="kw">unsafe</span> <span class="kw">impl</span> <span class="ident">Sync</span> <span class="kw">for</span> <span class="ident">RenderPipeline</span> {}

<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">ComputePipeline</span> {
    <span class="ident">inner</span>: <span class="ident">PipelineInner</span>,
}

<span class="comment">// SAFE: WASM doesn&#39;t have threads</span>
<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">target_arch</span> <span class="op">=</span> <span class="string">&quot;wasm32&quot;</span>)]</span>
<span class="kw">unsafe</span> <span class="kw">impl</span> <span class="ident">Send</span> <span class="kw">for</span> <span class="ident">ComputePipeline</span> {}
<span class="attribute">#[<span class="ident">cfg</span>(<span class="ident">target_arch</span> <span class="op">=</span> <span class="string">&quot;wasm32&quot;</span>)]</span>
<span class="kw">unsafe</span> <span class="kw">impl</span> <span class="ident">Sync</span> <span class="kw">for</span> <span class="ident">ComputePipeline</span> {}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Debug</span>)]</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">QuerySet</span> {
    <span class="ident">queries</span>: <span class="ident">Box</span><span class="op">&lt;</span>[<span class="ident">glow::Query</span>]<span class="op">&gt;</span>,
    <span class="ident">target</span>: <span class="ident">BindTarget</span>,
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Debug</span>)]</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">Fence</span> {
    <span class="ident">last_completed</span>: <span class="ident"><span class="kw">crate</span>::FenceValue</span>,
    <span class="ident">pending</span>: <span class="ident">Vec</span><span class="op">&lt;</span>(<span class="ident"><span class="kw">crate</span>::FenceValue</span>, <span class="ident">glow::Fence</span>)<span class="op">&gt;</span>,
}

<span class="kw">unsafe</span> <span class="kw">impl</span> <span class="ident">Send</span> <span class="kw">for</span> <span class="ident">Fence</span> {}
<span class="kw">unsafe</span> <span class="kw">impl</span> <span class="ident">Sync</span> <span class="kw">for</span> <span class="ident">Fence</span> {}

<span class="kw">impl</span> <span class="ident">Fence</span> {
    <span class="kw">fn</span> <span class="ident">get_latest</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">gl</span>: <span class="kw-2">&amp;</span><span class="ident">glow::Context</span>) -&gt; <span class="ident"><span class="kw">crate</span>::FenceValue</span> {
        <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">max_value</span> <span class="op">=</span> <span class="self">self</span>.<span class="ident">last_completed</span>;
        <span class="kw">for</span> <span class="kw-2">&amp;</span>(<span class="ident">value</span>, <span class="ident">sync</span>) <span class="kw">in</span> <span class="self">self</span>.<span class="ident">pending</span>.<span class="ident">iter</span>() {
            <span class="kw">let</span> <span class="ident">status</span> <span class="op">=</span> <span class="kw">unsafe</span> { <span class="ident">gl</span>.<span class="ident">get_sync_status</span>(<span class="ident">sync</span>) };
            <span class="kw">if</span> <span class="ident">status</span> <span class="op">==</span> <span class="ident">glow::SIGNALED</span> {
                <span class="ident">max_value</span> <span class="op">=</span> <span class="ident">value</span>;
            }
        }
        <span class="ident">max_value</span>
    }

    <span class="kw">fn</span> <span class="ident">maintain</span>(<span class="kw-2">&amp;mut</span> <span class="self">self</span>, <span class="ident">gl</span>: <span class="kw-2">&amp;</span><span class="ident">glow::Context</span>) {
        <span class="kw">let</span> <span class="ident">latest</span> <span class="op">=</span> <span class="self">self</span>.<span class="ident">get_latest</span>(<span class="ident">gl</span>);
        <span class="kw">for</span> <span class="kw-2">&amp;</span>(<span class="ident">value</span>, <span class="ident">sync</span>) <span class="kw">in</span> <span class="self">self</span>.<span class="ident">pending</span>.<span class="ident">iter</span>() {
            <span class="kw">if</span> <span class="ident">value</span> <span class="op">&lt;</span><span class="op">=</span> <span class="ident">latest</span> {
                <span class="kw">unsafe</span> {
                    <span class="ident">gl</span>.<span class="ident">delete_sync</span>(<span class="ident">sync</span>);
                }
            }
        }
        <span class="self">self</span>.<span class="ident">pending</span>.<span class="ident">retain</span>(<span class="op">|</span><span class="kw-2">&amp;</span>(<span class="ident">value</span>, <span class="kw">_</span>)<span class="op">|</span> <span class="ident">value</span> <span class="op">&gt;</span> <span class="ident">latest</span>);
        <span class="self">self</span>.<span class="ident">last_completed</span> <span class="op">=</span> <span class="ident">latest</span>;
    }
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Debug</span>, <span class="ident">PartialEq</span>)]</span>
<span class="kw">struct</span> <span class="ident">StencilOps</span> {
    <span class="ident">pass</span>: <span class="ident">u32</span>,
    <span class="ident">fail</span>: <span class="ident">u32</span>,
    <span class="ident">depth_fail</span>: <span class="ident">u32</span>,
}

<span class="kw">impl</span> <span class="ident">Default</span> <span class="kw">for</span> <span class="ident">StencilOps</span> {
    <span class="kw">fn</span> <span class="ident">default</span>() -&gt; <span class="self">Self</span> {
        <span class="self">Self</span> {
            <span class="ident">pass</span>: <span class="ident">glow::KEEP</span>,
            <span class="ident">fail</span>: <span class="ident">glow::KEEP</span>,
            <span class="ident">depth_fail</span>: <span class="ident">glow::KEEP</span>,
        }
    }
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Debug</span>, <span class="ident">PartialEq</span>)]</span>
<span class="kw">struct</span> <span class="ident">StencilSide</span> {
    <span class="ident">function</span>: <span class="ident">u32</span>,
    <span class="ident">mask_read</span>: <span class="ident">u32</span>,
    <span class="ident">mask_write</span>: <span class="ident">u32</span>,
    <span class="ident">reference</span>: <span class="ident">u32</span>,
    <span class="ident">ops</span>: <span class="ident">StencilOps</span>,
}

<span class="kw">impl</span> <span class="ident">Default</span> <span class="kw">for</span> <span class="ident">StencilSide</span> {
    <span class="kw">fn</span> <span class="ident">default</span>() -&gt; <span class="self">Self</span> {
        <span class="self">Self</span> {
            <span class="ident">function</span>: <span class="ident">glow::ALWAYS</span>,
            <span class="ident">mask_read</span>: <span class="number">0xFF</span>,
            <span class="ident">mask_write</span>: <span class="number">0xFF</span>,
            <span class="ident">reference</span>: <span class="number">0</span>,
            <span class="ident">ops</span>: <span class="ident">StencilOps::default</span>(),
        }
    }
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Default</span>)]</span>
<span class="kw">struct</span> <span class="ident">StencilState</span> {
    <span class="ident">front</span>: <span class="ident">StencilSide</span>,
    <span class="ident">back</span>: <span class="ident">StencilSide</span>,
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Debug</span>, <span class="ident">Default</span>, <span class="ident">PartialEq</span>)]</span>
<span class="kw">struct</span> <span class="ident">PrimitiveState</span> {
    <span class="ident">front_face</span>: <span class="ident">u32</span>,
    <span class="ident">cull_face</span>: <span class="ident">u32</span>,
    <span class="ident">unclipped_depth</span>: <span class="ident">bool</span>,
}

<span class="kw">type</span> <span class="ident">InvalidatedAttachments</span> <span class="op">=</span> <span class="ident">ArrayVec</span><span class="op">&lt;</span><span class="ident">u32</span>, { <span class="ident"><span class="kw">crate</span>::MAX_COLOR_TARGETS</span> <span class="op">+</span> <span class="number">2</span> }<span class="op">&gt;</span>;

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Debug</span>)]</span>
<span class="kw">enum</span> <span class="ident">Command</span> {
    <span class="ident">Draw</span> {
        <span class="ident">topology</span>: <span class="ident">u32</span>,
        <span class="ident">start_vertex</span>: <span class="ident">u32</span>,
        <span class="ident">vertex_count</span>: <span class="ident">u32</span>,
        <span class="ident">instance_count</span>: <span class="ident">u32</span>,
    },
    <span class="ident">DrawIndexed</span> {
        <span class="ident">topology</span>: <span class="ident">u32</span>,
        <span class="ident">index_type</span>: <span class="ident">u32</span>,
        <span class="ident">index_count</span>: <span class="ident">u32</span>,
        <span class="ident">index_offset</span>: <span class="ident">wgt::BufferAddress</span>,
        <span class="ident">base_vertex</span>: <span class="ident">i32</span>,
        <span class="ident">instance_count</span>: <span class="ident">u32</span>,
    },
    <span class="ident">DrawIndirect</span> {
        <span class="ident">topology</span>: <span class="ident">u32</span>,
        <span class="ident">indirect_buf</span>: <span class="ident">glow::Buffer</span>,
        <span class="ident">indirect_offset</span>: <span class="ident">wgt::BufferAddress</span>,
    },
    <span class="ident">DrawIndexedIndirect</span> {
        <span class="ident">topology</span>: <span class="ident">u32</span>,
        <span class="ident">index_type</span>: <span class="ident">u32</span>,
        <span class="ident">indirect_buf</span>: <span class="ident">glow::Buffer</span>,
        <span class="ident">indirect_offset</span>: <span class="ident">wgt::BufferAddress</span>,
    },
    <span class="ident">Dispatch</span>([<span class="ident">u32</span>; <span class="number">3</span>]),
    <span class="ident">DispatchIndirect</span> {
        <span class="ident">indirect_buf</span>: <span class="ident">glow::Buffer</span>,
        <span class="ident">indirect_offset</span>: <span class="ident">wgt::BufferAddress</span>,
    },
    <span class="ident">ClearBuffer</span> {
        <span class="ident">dst</span>: <span class="ident">Buffer</span>,
        <span class="ident">dst_target</span>: <span class="ident">BindTarget</span>,
        <span class="ident">range</span>: <span class="ident"><span class="kw">crate</span>::MemoryRange</span>,
    },
    <span class="ident">CopyBufferToBuffer</span> {
        <span class="ident">src</span>: <span class="ident">Buffer</span>,
        <span class="ident">src_target</span>: <span class="ident">BindTarget</span>,
        <span class="ident">dst</span>: <span class="ident">Buffer</span>,
        <span class="ident">dst_target</span>: <span class="ident">BindTarget</span>,
        <span class="ident">copy</span>: <span class="ident"><span class="kw">crate</span>::BufferCopy</span>,
    },
    <span class="ident">CopyTextureToTexture</span> {
        <span class="ident">src</span>: <span class="ident">glow::Texture</span>,
        <span class="ident">src_target</span>: <span class="ident">BindTarget</span>,
        <span class="ident">dst</span>: <span class="ident">glow::Texture</span>,
        <span class="ident">dst_target</span>: <span class="ident">BindTarget</span>,
        <span class="ident">copy</span>: <span class="ident"><span class="kw">crate</span>::TextureCopy</span>,
    },
    <span class="ident">CopyBufferToTexture</span> {
        <span class="ident">src</span>: <span class="ident">Buffer</span>,
        <span class="attribute">#[<span class="ident">allow</span>(<span class="ident">unused</span>)]</span>
        <span class="ident">src_target</span>: <span class="ident">BindTarget</span>,
        <span class="ident">dst</span>: <span class="ident">glow::Texture</span>,
        <span class="ident">dst_target</span>: <span class="ident">BindTarget</span>,
        <span class="ident">dst_format</span>: <span class="ident">wgt::TextureFormat</span>,
        <span class="ident">copy</span>: <span class="ident"><span class="kw">crate</span>::BufferTextureCopy</span>,
    },
    <span class="ident">CopyTextureToBuffer</span> {
        <span class="ident">src</span>: <span class="ident">glow::Texture</span>,
        <span class="ident">src_target</span>: <span class="ident">BindTarget</span>,
        <span class="ident">src_format</span>: <span class="ident">wgt::TextureFormat</span>,
        <span class="ident">dst</span>: <span class="ident">Buffer</span>,
        <span class="attribute">#[<span class="ident">allow</span>(<span class="ident">unused</span>)]</span>
        <span class="ident">dst_target</span>: <span class="ident">BindTarget</span>,
        <span class="ident">copy</span>: <span class="ident"><span class="kw">crate</span>::BufferTextureCopy</span>,
    },
    <span class="ident">SetIndexBuffer</span>(<span class="ident">glow::Buffer</span>),
    <span class="ident">BeginQuery</span>(<span class="ident">glow::Query</span>, <span class="ident">BindTarget</span>),
    <span class="ident">EndQuery</span>(<span class="ident">BindTarget</span>),
    <span class="ident">CopyQueryResults</span> {
        <span class="ident">query_range</span>: <span class="ident">Range</span><span class="op">&lt;</span><span class="ident">u32</span><span class="op">&gt;</span>,
        <span class="ident">dst</span>: <span class="ident">Buffer</span>,
        <span class="ident">dst_target</span>: <span class="ident">BindTarget</span>,
        <span class="ident">dst_offset</span>: <span class="ident">wgt::BufferAddress</span>,
    },
    <span class="ident">ResetFramebuffer</span> {
        <span class="ident">is_default</span>: <span class="ident">bool</span>,
    },
    <span class="ident">BindAttachment</span> {
        <span class="ident">attachment</span>: <span class="ident">u32</span>,
        <span class="ident">view</span>: <span class="ident">TextureView</span>,
    },
    <span class="ident">ResolveAttachment</span> {
        <span class="ident">attachment</span>: <span class="ident">u32</span>,
        <span class="ident">dst</span>: <span class="ident">TextureView</span>,
        <span class="ident">size</span>: <span class="ident">wgt::Extent3d</span>,
    },
    <span class="ident">InvalidateAttachments</span>(<span class="ident">InvalidatedAttachments</span>),
    <span class="ident">SetDrawColorBuffers</span>(<span class="ident">u8</span>),
    <span class="ident">ClearColorF</span> {
        <span class="ident">draw_buffer</span>: <span class="ident">u32</span>,
        <span class="ident">color</span>: [<span class="ident">f32</span>; <span class="number">4</span>],
        <span class="ident">is_srgb</span>: <span class="ident">bool</span>,
    },
    <span class="ident">ClearColorU</span>(<span class="ident">u32</span>, [<span class="ident">u32</span>; <span class="number">4</span>]),
    <span class="ident">ClearColorI</span>(<span class="ident">u32</span>, [<span class="ident">i32</span>; <span class="number">4</span>]),
    <span class="ident">ClearDepth</span>(<span class="ident">f32</span>),
    <span class="ident">ClearStencil</span>(<span class="ident">u32</span>),
    <span class="ident">BufferBarrier</span>(<span class="ident">glow::Buffer</span>, <span class="ident"><span class="kw">crate</span>::BufferUses</span>),
    <span class="ident">TextureBarrier</span>(<span class="ident"><span class="kw">crate</span>::TextureUses</span>),
    <span class="ident">SetViewport</span> {
        <span class="ident">rect</span>: <span class="ident"><span class="kw">crate</span>::Rect</span><span class="op">&lt;</span><span class="ident">i32</span><span class="op">&gt;</span>,
        <span class="ident">depth</span>: <span class="ident">Range</span><span class="op">&lt;</span><span class="ident">f32</span><span class="op">&gt;</span>,
    },
    <span class="ident">SetScissor</span>(<span class="ident"><span class="kw">crate</span>::Rect</span><span class="op">&lt;</span><span class="ident">i32</span><span class="op">&gt;</span>),
    <span class="ident">SetStencilFunc</span> {
        <span class="ident">face</span>: <span class="ident">u32</span>,
        <span class="ident">function</span>: <span class="ident">u32</span>,
        <span class="ident">reference</span>: <span class="ident">u32</span>,
        <span class="ident">read_mask</span>: <span class="ident">u32</span>,
    },
    <span class="ident">SetStencilOps</span> {
        <span class="ident">face</span>: <span class="ident">u32</span>,
        <span class="ident">write_mask</span>: <span class="ident">u32</span>,
        <span class="ident">ops</span>: <span class="ident">StencilOps</span>,
    },
    <span class="ident">SetDepth</span>(<span class="ident">DepthState</span>),
    <span class="ident">SetDepthBias</span>(<span class="ident">wgt::DepthBiasState</span>),
    <span class="ident">ConfigureDepthStencil</span>(<span class="ident"><span class="kw">crate</span>::FormatAspects</span>),
    <span class="ident">SetVertexAttribute</span> {
        <span class="ident">buffer</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">glow::Buffer</span><span class="op">&gt;</span>,
        <span class="ident">buffer_desc</span>: <span class="ident">VertexBufferDesc</span>,
        <span class="ident">attribute_desc</span>: <span class="ident">AttributeDesc</span>,
    },
    <span class="ident">UnsetVertexAttribute</span>(<span class="ident">u32</span>),
    <span class="ident">SetVertexBuffer</span> {
        <span class="ident">index</span>: <span class="ident">u32</span>,
        <span class="ident">buffer</span>: <span class="ident">BufferBinding</span>,
        <span class="ident">buffer_desc</span>: <span class="ident">VertexBufferDesc</span>,
    },
    <span class="ident">SetProgram</span>(<span class="ident">glow::Program</span>),
    <span class="ident">SetPrimitive</span>(<span class="ident">PrimitiveState</span>),
    <span class="ident">SetBlendConstant</span>([<span class="ident">f32</span>; <span class="number">4</span>]),
    <span class="ident">SetColorTarget</span> {
        <span class="ident">draw_buffer_index</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">u32</span><span class="op">&gt;</span>,
        <span class="ident">desc</span>: <span class="ident">ColorTargetDesc</span>,
    },
    <span class="ident">BindBuffer</span> {
        <span class="ident">target</span>: <span class="ident">BindTarget</span>,
        <span class="ident">slot</span>: <span class="ident">u32</span>,
        <span class="ident">buffer</span>: <span class="ident">glow::Buffer</span>,
        <span class="ident">offset</span>: <span class="ident">i32</span>,
        <span class="ident">size</span>: <span class="ident">i32</span>,
    },
    <span class="ident">BindSampler</span>(<span class="ident">u32</span>, <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">glow::Sampler</span><span class="op">&gt;</span>),
    <span class="ident">BindTexture</span> {
        <span class="ident">slot</span>: <span class="ident">u32</span>,
        <span class="ident">texture</span>: <span class="ident">glow::Texture</span>,
        <span class="ident">target</span>: <span class="ident">BindTarget</span>,
    },
    <span class="ident">BindImage</span> {
        <span class="ident">slot</span>: <span class="ident">u32</span>,
        <span class="ident">binding</span>: <span class="ident">ImageBinding</span>,
    },
    <span class="ident">InsertDebugMarker</span>(<span class="ident">Range</span><span class="op">&lt;</span><span class="ident">u32</span><span class="op">&gt;</span>),
    <span class="ident">PushDebugGroup</span>(<span class="ident">Range</span><span class="op">&lt;</span><span class="ident">u32</span><span class="op">&gt;</span>),
    <span class="ident">PopDebugGroup</span>,
    <span class="ident">SetPushConstants</span> {
        <span class="ident">uniform</span>: <span class="ident">UniformDesc</span>,
        <span class="doccomment">/// Offset from the start of the `data_bytes`</span>
        <span class="ident">offset</span>: <span class="ident">u32</span>,
    },
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Default</span>)]</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">CommandBuffer</span> {
    <span class="ident">label</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">String</span><span class="op">&gt;</span>,
    <span class="ident">commands</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">Command</span><span class="op">&gt;</span>,
    <span class="ident">data_bytes</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">u8</span><span class="op">&gt;</span>,
    <span class="ident">queries</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">glow::Query</span><span class="op">&gt;</span>,
}

<span class="comment">//TODO: we would have something like `Arc&lt;typed_arena::Arena&gt;`</span>
<span class="comment">// here and in the command buffers. So that everything grows</span>
<span class="comment">// inside the encoder and stays there until `reset_all`.</span>

<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">CommandEncoder</span> {
    <span class="ident">cmd_buffer</span>: <span class="ident">CommandBuffer</span>,
    <span class="ident">state</span>: <span class="ident">command::State</span>,
    <span class="ident">private_caps</span>: <span class="ident">PrivateCapabilities</span>,
}
</code></pre></div>
</section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="wgpu_hal" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.61.0-nightly (68369a041 2022-02-22)" ></div>
</body></html>